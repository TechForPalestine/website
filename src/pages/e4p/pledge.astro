---
import Layout from "../../layouts/Layout.astro";
import Signatories from "../../components/Signatories.tsx";
import "../../styles/base.css";
---

<Layout title="E4P Pledge">
  <main>
    <div class="relative h-96 overflow-hidden">
      <img
        src="/images/e4p-pledge-hero.jpg"
        alt="E4P Pledge Hero"
        class="absolute inset-0 h-full w-full object-cover"
      />
      <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40">
        <div class="w-full text-center text-white">
          <h1 class="bg-black bg-opacity-40 py-6 text-7xl font-bold tracking-wide">PLEDGE</h1>
        </div>
      </div>
    </div>

    <div class="container mx-auto max-w-4xl px-4 py-16">
      <div class="mb-12">
        <p class="font-semibold text-red-600">SIGN NOW</p>
        <h2 class="my-4 text-6xl font-extrabold text-gray-900">OUR PLEDGE</h2>
        <div class="mb-8 h-1 w-10 bg-red-600"></div>
        <div class="prose prose-lg max-w-none space-y-6 text-gray-500">
          <p>
            We, entrepreneurs, founders, and CEOs, as witnesses of the genocide in Gaza and the
            77-year long colonization and occupation of Palestine, are signing this open letter in
            order to pledge our support for the Palestinian struggle for justice, equality and
            liberation and to boycott Israeli businesses and all businesses who are complicit in
            perpetuating the Israeli colonial system of oppression and apartheid in Palestine.
          </p>

          <p>
            The private sector, and especially the tech and startup industry, has historically
            played a very important role in legitimizing the state of Israel and deepening the
            ongoing dispossession of Palestinians. Now is the time for private businesses to take a
            strong stance against the current genocide in Gaza, and against the colonization of
            Palestine.
          </p>

          <p>
            We assert that all companies, no matter where they are based, can make an impact by
            adopting this position across their activities: hiring, supply chain, trade relations,
            raising capital, and more.
          </p>
          <p>
            Therefore <span class="font-extrabold text-gray-700"
              >we pledge to steer our companiesâ€™ hiring policies, operations, delivery of goods,
              provision of services, fundraising, and PR activities in order to support Palestine
              and Palestinians in their fight for self-determination and ownership of the land
              despite military, political, and economic efforts to displace and eliminate them. This
              may include:</span
            >
          </p>
          <ul class="list-disc space-y-2 pl-6 marker:text-red-600">
            <li>
              Hiring Palestinian talent, donating to Palestinian causes, incorporating Palestinian
              suppliers in our supply chains, and raising money from investors who support the
              Palestinian cause.
            </li>
            <li>
              Carrying out strategic boycotts of Israeli and other businesses, entities and
              individuals who support Zionism and are complicit in the current genocide and the
              ongoing colonization of Palestine, to the extent permitted by law.
            </li>
          </ul>
          <p>
            In making this pledge, we reject any kind of discrimination on the basis of ethnicity,
            race, or religion, including antisemitism and islamophobia. We stand against Zionism as
            an ideology and we promote values such as democracy, equality, self-determination and
            justice.
          </p>

          <p>
            Through this pledge, we join the wider BDS movement and we aim to exert pressure on
            Israel and its economy, following the example of successful international campaigns such
            as the anti-apartheid movement in the case of South Africa.
          </p>

          <p>
            We call on entrepreneurs globally to sign this letter and to join the movement for a
            free Palestine.
          </p>
        </div>
      </div>

      <div class="rounded-lg bg-gray-50">
        <p class="font-semibold text-red-600">SIGN NOW</p>
        <h3 class="my-4 text-6xl font-extrabold text-gray-900">SIGN NOW</h3>
        <div class="mb-8 h-1 w-10 bg-red-600"></div>

        <div id="form-message" class="mb-4 hidden rounded-md p-4"></div>

        <form class="space-y-4" id="pledge-form" method="POST">
          <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
            <div>
              <label for="Name" class="mb-1 block text-sm font-medium text-gray-700">Name *</label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500"
              />
            </div>
            <div>
              <label for="email" class="mb-1 block text-sm font-medium text-gray-700">Email *</label
              >
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
            <div>
              <label for="company" class="mb-1 block text-sm font-medium text-gray-700"
                >Your Company *</label
              >
              <input
                type="text"
                id="company"
                name="company"
                required
                class="w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500"
              />
            </div>
            <div>
              <label for="position" class="mb-1 block text-sm font-medium text-gray-700"
                >Your position *</label
              >
              <input
                type="text"
                id="position"
                name="position"
                required
                class="w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500"
              />
            </div>
          </div>

          <div>
            <label for="linkedin" class="mb-1 block text-sm font-medium text-gray-700"
              >LinkedIn URL *</label
            >
            <input
              type="url"
              id="linkedin"
              name="linkedin"
              placeholder="https://linkedin.com/in/your-profile"
              required
              class="w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500"
            />
          </div>

          <div class="flex items-start space-x-3">
            <input
              type="checkbox"
              id="agreement"
              name="agreement"
              required
              class="mt-1 h-4 w-4 rounded border-gray-300 text-red-600 focus:ring-red-500"
            />
            <label for="agreement" class="text-sm text-gray-700">
              I agree that my submitted data will be processed and stored by Entrepreneurs for
              Palestine and that my name, position and company will be listed under the Signatories
              section of this pledge.
            </label>
          </div>

          <div class="pt-4">
            <button
              type="submit"
              id="submit-button"
              class="w-full rounded-md bg-red-600 px-8 py-3 font-semibold text-white transition-colors hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:w-auto"
            >
              <span id="submit-text">Sign pledge</span>
            </button>
          </div>
        </form>
      </div>

      <div class="mt-16">
        <p class="font-semibold text-red-600">FULL LIST</p>
        <h3 class="my-4 text-6xl font-extrabold text-gray-900">SIGNATORIES</h3>
        <div class="mb-8 h-1 w-10 bg-red-600"></div>
        <Signatories client:only="react" />
      </div>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("pledge-form") as HTMLFormElement | null;
      const messageDiv = document.getElementById("form-message") as HTMLDivElement | null;
      const submitButton = document.getElementById("submit-button") as HTMLButtonElement | null;
      const submitText = document.getElementById("submit-text") as HTMLSpanElement | null;

      if (!form || !messageDiv || !submitButton || !submitText) {
        console.error("Required form elements not found");
        return;
      }

      function showMessage(message: string, isError: boolean = false): void {
        if (!messageDiv) return;
        messageDiv.textContent = message;
        messageDiv.className = `p-4 rounded-md mb-4 ${isError ? "bg-red-50 text-red-800 border border-red-200" : "bg-green-50 text-green-800 border border-green-200"}`;
        messageDiv.classList.remove("hidden");
        messageDiv.scrollIntoView({ behavior: "smooth", block: "center" });
      }

      function setLoading(loading: boolean): void {
        if (!submitButton || !submitText) return;
        submitButton.disabled = loading;
        submitText.textContent = loading ? "Signing..." : "Sign pledge";
      }

      form.addEventListener("submit", async function (e: Event) {
        e.preventDefault();

        if (!form || !messageDiv) return;

        setLoading(true);
        messageDiv.classList.add("hidden");

        try {
          const formData = new FormData(form);

          const response = await fetch("/api/e4p-pledge-sign", {
            method: "POST",
            body: formData,
          });

          const result = await response.json();

          if (response.ok) {
            showMessage(
              "Thank you for signing the pledge. We will include you in the list of signatories once your submission has been verified."
            );
            form.reset();
          } else {
            showMessage(result.error || "Failed to submit pledge. Please try again.", true);
          }
        } catch (error) {
          console.error("Error submitting pledge:", error);
          showMessage("Network error. Please check your connection and try again.", true);
        } finally {
          setLoading(false);
        }
      });
    });
  </script>
</Layout>
