---
import Layout from "../layouts/Layout.astro";
import Events from "../components/Events.tsx";
import "../styles/base.css";
import PageHeader from "../components/PageHeader.astro";

import { fetchNotionEvents } from "../store/notionClient";

let events = [];
let loading = true;

// Skip SSR fetch for now - let client handle it (SSR takes 30+ seconds)
console.log("SSR: Skipping server-side fetch, letting client load data");

// TODO: Re-enable SSR once we fix the 30-second delay
// The API route /api/events works instantly, but SSR fetchNotionEvents() hangs
// try {
//     events = await fetchNotionEvents();
//     console.log(`SSR: Loaded ${events.length} events for initial page load`);
//     loading = false;
// } catch (err) {
//     loading = true;
//     console.error("SSR: Error fetching events:", err);
// }
---
    <Layout title="Events">
        <PageHeader
            overline="Tech for Palestine"
            title="Events"
            subtitle="Tech for Palestine events bring together builders, organizers, and allies to collaborate, share ideas, and take action."
        />

        <Events events={events} loading={loading} client:only="react" />
    </Layout>
