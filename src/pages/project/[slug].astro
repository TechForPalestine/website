---
import Layout from "../../layouts/Layout.astro";
import ProjectLogo from "../../components/ProjectLogo";
import { getCollection } from "astro:content";
import "../../styles/base.css";

export const prerender = true;
// Slug from URL
const { slug } = Astro.params;

// Slugify function (same logic used in the listing page)
function slugify(name: string) {
  return name
    .replace(/[^a-zA-Z0-9\s]/g, "")
    .trim()
    .toLowerCase()
    .split(/\s+/)
    .join("-");
}

// Load all projects and find the matching one
const entries = await getCollection("projects");
const project = entries.find((entry) => slugify(entry.data.title) === slug);

if (!project) throw new Error("Project not found");

// Render markdown content
const { Content } = await project.render();

// Export getStaticPaths for static generation
export async function getStaticPaths() {
  const entries = await getCollection("projects");
  function slugify(name: string) {
    return name
      .replace(/[^a-zA-Z0-9\s]/g, "")
      .trim()
      .toLowerCase()
      .split(/\s+/)
      .join("-");
  }
  return entries.map((entry) => ({
    params: { slug: slugify(entry.data.title) },
  }));
}
console.log(project.data, "project.data");
---

<Layout title={project.data.title}>
  <div class="mx-auto max-w-4xl space-y-10 px-4 py-16">
    <!-- Header: Logo + Title + Links -->
    <div class="flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-4">
        <div
          class="flex h-20 w-20 items-center justify-center rounded-full border border-gray-300 bg-white shadow"
        >
          <ProjectLogo projectName={project.data.title} client:only="react" />
        </div>
        <h1 class="text-3xl font-bold text-gray-900">{project.data.title}</h1>
      </div>

      <!-- Links -->
      <div class="flex gap-4">
        {
          project.data.url && (
            <a
              href={project.data.url}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 rounded-full bg-blue-600 px-4 py-2 text-white transition hover:bg-blue-700"
            >
              ğŸŒ Website
            </a>
          )
        }
        {
          project.data.channel && (
            <a
              href={project.data.channel}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 rounded-full bg-indigo-600 px-4 py-2 text-white transition hover:bg-indigo-700"
            >
              ğŸ’¬ Discord
            </a>
          )
        }
      </div>
    </div>

    <!-- Divider -->
    <hr class="border-t border-gray-300" />

    <!-- Description -->
    <div class="prose prose-lg max-w-none rounded-xl border border-gray-200 bg-white p-6 shadow-md">
      <Content />
    </div>
  </div>
</Layout>
